(function($){$.jqplot.OHLCRenderer=function(){$.jqplot.LineRenderer.call(this);this.candleStick=false;this.tickLength='auto';this.bodyWidth='auto';this.openColor=null;this.closeColor=null;this.wickColor=null;this.fillUpBody=false;this.fillDownBody=true;this.upBodyColor=null;this.downBodyColor=null;this.hlc=false;this.lineWidth=1.5;this._tickLength;this._bodyWidth;};$.jqplot.OHLCRenderer.prototype=new $.jqplot.LineRenderer();$.jqplot.OHLCRenderer.prototype.constructor=$.jqplot.OHLCRenderer;$.jqplot.OHLCRenderer.prototype.init=function(options){options=options||{};this.lineWidth=options.lineWidth||1.5;$.jqplot.LineRenderer.prototype.init.call(this,options);this._type='ohlc';var db=this._yaxis._dataBounds;var d=this._plotData;if(d[0].length<5){this.renderer.hlc=true;for(var j=0;j<d.length;j++){if(d[j][2]<db.min||db.min==null){db.min=d[j][2];}
if(d[j][1]>db.max||db.max==null){db.max=d[j][1];}}}
else{for(var j=0;j<d.length;j++){if(d[j][3]<db.min||db.min==null){db.min=d[j][3];}
if(d[j][2]>db.max||db.max==null){db.max=d[j][2];}}}};$.jqplot.OHLCRenderer.prototype.draw=function(ctx,gd,options){var d=this.data;var xmin=this._xaxis.min;var xmax=this._xaxis.max;var xminidx=0;var xmaxidx=d.length;var xp=this._xaxis.series_u2p;var yp=this._yaxis.series_u2p;var i,prevColor,ops,b,h,w,a,points;var o;var r=this.renderer;var opts=(options!=undefined)?options:{};var shadow=(opts.shadow!=undefined)?opts.shadow:this.shadow;var fill=(opts.fill!=undefined)?opts.fill:this.fill;var fillAndStroke=(opts.fillAndStroke!=undefined)?opts.fillAndStroke:this.fillAndStroke;r.bodyWidth=(opts.bodyWidth!=undefined)?opts.bodyWidth:r.bodyWidth;r.tickLength=(opts.tickLength!=undefined)?opts.tickLength:r.tickLength;ctx.save();if(this.show){var x,open,hi,low,close;for(var i=0;i<d.length;i++){if(d[i][0]<xmin){xminidx=i;}
else if(d[i][0]<xmax){xmaxidx=i+1;}}
var dwidth=this.gridData[xmaxidx-1][0]-this.gridData[xminidx][0];var nvisiblePoints=xmaxidx-xminidx;try{var dinterval=Math.abs(this._xaxis.series_u2p(parseInt(this._xaxis._intervalStats[0].sortedIntervals[0].interval))-this._xaxis.series_u2p(0));}
catch(e){var dinterval=dwidth/nvisiblePoints;}
if(r.candleStick){if(typeof(r.bodyWidth)=='number'){r._bodyWidth=r.bodyWidth;}
else{r._bodyWidth=Math.min(20,dinterval/1.75);}}
else{if(typeof(r.tickLength)=='number'){r._tickLength=r.tickLength;}
else{r._tickLength=Math.min(10,dinterval/3.5);}}
for(var i=xminidx;i<xmaxidx;i++){x=xp(d[i][0]);if(r.hlc){open=null;hi=yp(d[i][1]);low=yp(d[i][2]);close=yp(d[i][3]);}
else{open=yp(d[i][1]);hi=yp(d[i][2]);low=yp(d[i][3]);close=yp(d[i][4]);}
o={};if(r.candleStick&&!r.hlc){w=r._bodyWidth;a=x-w/2;if(close<open){if(r.wickColor){o.color=r.wickColor;}
else if(r.downBodyColor){o.color=r.upBodyColor;}
ops=$.extend(true,{},opts,o);r.shapeRenderer.draw(ctx,[[x,hi],[x,close]],ops);r.shapeRenderer.draw(ctx,[[x,open],[x,low]],ops);o={};b=close;h=open-close;if(r.fillUpBody){o.fillRect=true;}
else{o.strokeRect=true;w=w-this.lineWidth;a=x-w/2;}
if(r.upBodyColor){o.color=r.upBodyColor;o.fillStyle=r.upBodyColor;}
points=[a,b,w,h];}
else if(close>open){if(r.wickColor){o.color=r.wickColor;}
else if(r.downBodyColor){o.color=r.downBodyColor;}
ops=$.extend(true,{},opts,o);r.shapeRenderer.draw(ctx,[[x,hi],[x,open]],ops);r.shapeRenderer.draw(ctx,[[x,close],[x,low]],ops);o={};b=open;h=close-open;if(r.fillDownBody){o.fillRect=true;}
else{o.strokeRect=true;w=w-this.lineWidth;a=x-w/2;}
if(r.downBodyColor){o.color=r.downBodyColor;o.fillStyle=r.downBodyColor;}
points=[a,b,w,h];}
else{if(r.wickColor){o.color=r.wickColor;}
ops=$.extend(true,{},opts,o);r.shapeRenderer.draw(ctx,[[x,hi],[x,low]],ops);o={};o.fillRect=false;o.strokeRect=false;a=[x-w/2,open];b=[x+w/2,close];w=null;h=null;points=[a,b];}
ops=$.extend(true,{},opts,o);r.shapeRenderer.draw(ctx,points,ops);}
else if(r.errorBar){prevColor=opts.color;if(r.openColor){opts.color=r.openColor;}
opts.color=prevColor;if(r.wickColor){opts.color=r.wickColor;}
r.shapeRenderer.draw(ctx,[[x,hi],[x,low]],opts);opts.color=prevColor;r.shapeRenderer.draw(ctx,[[x+r._tickLength/2,hi],[x-r._tickLength/2,hi]],opts);r.shapeRenderer.draw(ctx,[[x+r._tickLength/2,low],[x-r._tickLength/2,low]],opts);opts.fillRect=true;r.shapeRenderer.draw(ctx,[Math.round(x-(r._tickLength/4)),Math.round(close-(r._tickLength/4)),r._tickLength/2,r._tickLength/2],opts);opts.color=prevColor;opts.fillRect=false;}
else{prevColor=opts.color;if(r.openColor){opts.color=r.openColor;}
if(!r.hlc){r.shapeRenderer.draw(ctx,[[x-r._tickLength,open],[x,open]],opts);}
opts.color=prevColor;if(r.wickColor){opts.color=r.wickColor;}
r.shapeRenderer.draw(ctx,[[x,hi],[x,low]],opts);opts.color=prevColor;if(r.closeColor){opts.color=r.closeColor;}
r.shapeRenderer.draw(ctx,[[x,close],[x+r._tickLength,close]],opts);opts.color=prevColor;}}}
ctx.restore();};$.jqplot.OHLCRenderer.prototype.drawShadow=function(ctx,gd,options){};$.jqplot.OHLCRenderer.checkOptions=function(target,data,options){if(!options.highlighter){options.highlighter={showMarker:false,tooltipAxes:'y',yvalues:4,formatString:'<table class="jqplot-highlighter"><tr><td>date:</td><td>%s</td></tr><tr><td>open:</td><td>%s</td></tr><tr><td>hi:</td><td>%s</td></tr><tr><td>low:</td><td>%s</td></tr><tr><td>close:</td><td>%s</td></tr></table>'};}};})(jQuery);
